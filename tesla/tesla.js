/*!(C)Andrea Giammarchi*/function Tesla(b,a){var d=b.ownerDocument,c=Math.abs;a||(a={});if(d){d.addEventListener("touchstart",{handleEvent:this.handleEvent,self:this},false);this.document=d}else this.document=b;this.touches=[];this.frequency=c(a.frequency)||30;this.blur=c(a.blur)||0;this.noise=c(a.noise)||0;this.noiserad=(c(a.noiserad)||50)*2;this.delta=c(a.delta)||5;this.ratio=c(a.ratio)||5;this.rays=c(a.rays)||1;this.width=c(a.width)||1;this.shadow=a.shadow?decodeURIComponent(a.shadow):"rgba(255,255,255,0.9)";this.stroke= a.stroke===false?false:decodeURIComponent(a.stroke)||"rgba(0,0,255,0.6)";this.fill=a.fill===false?false:decodeURIComponent(a.fill)||"rgba(255,255,255,0.9)";this.node=this._e=b;this.canvas=d.createElement("canvas");this.resize(b.offsetWidth,b.offsetHeight);this.context=this.canvas.getContext("2d");this.draw(this);b.addEventListener("touchstart",this,false);b.addEventListener("mousedown",this,false);b.appendChild(this.canvas)} Tesla.prototype.resize=function(b,a){var d=this.canvas;d.width=b;d.height=a;this.center={x:Math.round(b/2),y:Math.round(a/2)};return this}; Tesla.prototype.handleEvent=function(b){var a=this;if(b.type=="touchstart"){if(a.self){(a=a.self).node.removeEventListener("touchstart",a,false);a._e=a.document}else a.document.removeEventListener("touchstart",a,false);a.node.removeEventListener("mousedown",a,false);a.handleEvent=a.touchEvent;a._e.addEventListener("touchmove",a,false);a._e.addEventListener("touchend",a,false);a._e.addEventListener("gesturestart",a.stopEvent,false);a._e.addEventListener("gesturechange",a.stopEvent,false);a._e.addEventListener("gestureend", a.stopEvent,false);a._e.addEventListener("transformactionstart",a.stopEvent,false);a._e.addEventListener("transformactionupdate",a.stopEvent,false);a._e.addEventListener("transformactionend",a.stopEvent,false)}else{a.node.removeEventListener("touchstart",a,false);a.document.removeEventListener("touchstart",a,false);a.handleEvent=a.mouseEvent;a._e.addEventListener("mousemove",a,false);a._e.addEventListener("mouseup",a,false)}a.handleEvent(b)}; Tesla.prototype.stopEvent=function(b){b.preventDefault();b.stopPropagation()};Tesla.prototype.position=function(){var b=this.canvas,a=0,d=0;do{a+=b.offsetLeft;d+=b.offsetTop}while(b=b.offsetParent);this.position.x=a;this.position.y=d;return this};Tesla.prototype.createNoise=function(){var b=this.canvas,a=Math.random,d=b.width/2;b=b.height/2;for(var c=this.noiserad,h=c/2,j=[],f=this.noise;f--;)j[f]={noise:true,pageX:d-h+a()*c,pageY:b-h+a()*c};return j}; Tesla.prototype.draw=function(b){b.clean().position().createNoise().forEach(b.lightning,b);b.touches.forEach(b.lightning,b);b.timeout=setTimeout(b.draw,b.frequency,b)}; Tesla.prototype.lightning=function(b){var a=this.context;a.beginPath();lightning(a,this.center.x,this.center.y,b.pageX-this.position.x,b.pageY-this.position.y,this.delta,this.ratio,this.rays);a.lineWidth=this.width;if(this.blur){a.shadowBlur=this.blur;a.shadowColor=this.shadow}if(this.fill&&!b.noise){a.fillStyle=this.fill;a.fill()}if(this.stroke){a.strokeStyle=this.stroke;a.stroke()}};Tesla.prototype.clean=function(){var b=this.canvas;this.context.clearRect(0,0,b.width,b.height);return this}; Tesla.prototype.touchEvent=function(b){var a=this.touches.forEach;this.stopEvent(b);(this.touches=b.touches||[]).forEach=a};Tesla.prototype.mouseEvent=function(b){this.stopEvent(b);switch(b.type){case "mouseup":this.touches=[];break;case "mousedown":this.touches=[b];case "mousemove":if(this.touches.length)this.touches=[b];break}}; function lightning(b,a,d,c,h,j,f,q){for(var l=a<c,m=d<h,n=c+(l?-f:f),o=h+(m?-f:f),p=Math.random,r=Math.cos,s=Math.sin,t=Math.PI,i,k,g,e;q--;){b.moveTo(g=a,e=d);do{i=c-g;k=h-e;g=g+i/f;k=e+k/f;e=p()*2*t;i=p()*j;g=g+i*r(e);e=k+i*s(e);b.lineTo(g,e)}while((l?g<n:n<g)||(m?e<o:o<e));b.lineTo(c,h)}};